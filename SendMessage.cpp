#include <windows.h>
#include <commctrl.h>
#include <richedit.h>
#include <stdio.h>
#include <tchar.h>
#include <inttypes.h>

#include "arg.inl"

HWND GetWindow(const TCHAR* s)
{
    if (s == nullptr)
        return NULL;
    else if (_tcsicmp(s, _T("{cursor}")) == 0)
    {
        POINT pt;
        GetCursorPos(&pt);
        return WindowFromPoint(pt);
    }
    else if (_tcsicmp(s, _T("{console}")) == 0)
        return GetConsoleWindow();
    else if (_tcsicmp(s, _T("{foreground}")) == 0)
        return GetForegroundWindow();
    else
        return static_cast<HWND>(UlongToHandle(_tcstoul(s, nullptr, 0)));
}

unsigned long ConvertToULong(const TCHAR* s, unsigned long def)
{
    if (s == nullptr)
        return def;
    else
        return _tcstoul(s, nullptr, 0);
}

int ConvertToInt(const TCHAR* s, int def)
{
    if (s == nullptr)
        return def;
    else if (_tcsnicmp(s, _T("0x"), 2) == 0)
        return _tcstol(s, nullptr, 16);
    else
        return _ttoi(s);
}

struct
{
    UINT uMsg;
    const TCHAR* sName;
} Messages[] = {
#define F(M) { M, _T(#M) },
    F(WM_NULL)
    F(WM_CREATE)
    F(WM_DESTROY)
    F(WM_MOVE)
    F(WM_SIZE)
    F(WM_ACTIVATE)
    F(WM_SETFOCUS)
    F(WM_KILLFOCUS)
    F(WM_ENABLE)
    F(WM_SETREDRAW)
    F(WM_SETTEXT)
    F(WM_GETTEXT)
    F(WM_GETTEXTLENGTH)
    F(WM_PAINT)
    F(WM_CLOSE)
    F(WM_QUERYENDSESSION)
    F(WM_QUIT)
    F(WM_QUERYOPEN)
    F(WM_ERASEBKGND)
    F(WM_SYSCOLORCHANGE)
    F(WM_ENDSESSION)
    F(WM_SHOWWINDOW)
    //F(WM_CTLCOLOR)
    F(WM_WININICHANGE)
    F(WM_DEVMODECHANGE)
    F(WM_ACTIVATEAPP)
    F(WM_FONTCHANGE)
    F(WM_TIMECHANGE)
    F(WM_CANCELMODE)
    F(WM_SETCURSOR)
    F(WM_MOUSEACTIVATE)
    F(WM_CHILDACTIVATE)
    F(WM_QUEUESYNC)
    F(WM_GETMINMAXINFO)
    F(WM_PAINTICON)
    F(WM_ICONERASEBKGND)
    F(WM_NEXTDLGCTL)
    F(WM_SPOOLERSTATUS)
    F(WM_DRAWITEM)
    F(WM_MEASUREITEM)
    F(WM_DELETEITEM)
    F(WM_VKEYTOITEM)
    F(WM_CHARTOITEM)
    F(WM_SETFONT)
    F(WM_GETFONT)
    F(WM_SETHOTKEY)
    F(WM_GETHOTKEY)
    F(WM_QUERYDRAGICON)
    F(WM_COMPAREITEM)
    F(WM_GETOBJECT)
    F(WM_COMPACTING)
    F(WM_COMMNOTIFY)
    F(WM_WINDOWPOSCHANGING)
    F(WM_WINDOWPOSCHANGED)
    F(WM_POWER)
    //F(WM_COPYGLOBALDATA)
    F(WM_COPYDATA)
    F(WM_CANCELJOURNAL)
    F(WM_NOTIFY)
    F(WM_INPUTLANGCHANGEREQUEST)
    F(WM_INPUTLANGCHANGE)
    F(WM_TCARD)
    F(WM_HELP)
    F(WM_USERCHANGED)
    F(WM_NOTIFYFORMAT)
    F(WM_CONTEXTMENU)
    F(WM_STYLECHANGING)
    F(WM_STYLECHANGED)
    F(WM_DISPLAYCHANGE)
    F(WM_GETICON)
    F(WM_SETICON)
    F(WM_NCCREATE)
    F(WM_NCDESTROY)
    F(WM_NCCALCSIZE)
    F(WM_NCHITTEST)
    F(WM_NCPAINT)
    F(WM_NCACTIVATE)
    F(WM_GETDLGCODE)
    F(WM_SYNCPAINT)
    F(WM_NCMOUSEMOVE)
    F(WM_NCLBUTTONDOWN)
    F(WM_NCLBUTTONUP)
    F(WM_NCLBUTTONDBLCLK)
    F(WM_NCRBUTTONDOWN)
    F(WM_NCRBUTTONUP)
    F(WM_NCRBUTTONDBLCLK)
    F(WM_NCMBUTTONDOWN)
    F(WM_NCMBUTTONUP)
    F(WM_NCMBUTTONDBLCLK)
    F(WM_NCXBUTTONDOWN)
    F(WM_NCXBUTTONUP)
    F(WM_NCXBUTTONDBLCLK)
    F(EM_GETSEL)
    F(EM_SETSEL)
    F(EM_GETRECT)
    F(EM_SETRECT)
    F(EM_SETRECTNP)
    F(EM_SCROLL)
    F(EM_LINESCROLL)
    F(EM_SCROLLCARET)
    F(EM_GETMODIFY)
    F(EM_SETMODIFY)
    F(EM_GETLINECOUNT)
    F(EM_LINEINDEX)
    F(EM_SETHANDLE)
    F(EM_GETHANDLE)
    F(EM_GETTHUMB)
    F(EM_LINELENGTH)
    F(EM_REPLACESEL)
    //F(EM_SETFONT)
    F(EM_GETLINE)
    F(EM_LIMITTEXT) F(EM_SETLIMITTEXT)
    F(EM_CANUNDO)
    F(EM_UNDO)
    F(EM_FMTLINES)
    F(EM_LINEFROMCHAR)
    //F(EM_SETWORDBREAK)
    F(EM_SETTABSTOPS)
    F(EM_SETPASSWORDCHAR)
    F(EM_EMPTYUNDOBUFFER)
    F(EM_GETFIRSTVISIBLELINE)
    F(EM_SETREADONLY)
    F(EM_SETWORDBREAKPROC) F(EM_GETWORDBREAKPROC)
    F(EM_GETPASSWORDCHAR)
    F(EM_SETMARGINS)
    F(EM_GETMARGINS)
    F(EM_GETLIMITTEXT)
    F(EM_POSFROMCHAR)
    F(EM_CHARFROMPOS)
    F(EM_SETIMESTATUS)
    F(EM_GETIMESTATUS)
    F(SBM_SETPOS)
    F(SBM_GETPOS)
    F(SBM_SETRANGE)
    F(SBM_GETRANGE)
    F(SBM_ENABLE_ARROWS)
    F(SBM_SETRANGEREDRAW)
    F(SBM_SETSCROLLINFO)
    F(SBM_GETSCROLLINFO)
    F(SBM_GETSCROLLBARINFO)
    F(BM_GETCHECK)
    F(BM_SETCHECK)
    F(BM_GETSTATE)
    F(BM_SETSTATE)
    F(BM_SETSTYLE)
    F(BM_CLICK)
    F(BM_GETIMAGE)
    F(BM_SETIMAGE)
    F(BM_SETDONTCLICK)
    F(WM_INPUT)
    F(WM_KEYDOWN)
    F(WM_KEYUP)
    F(WM_CHAR)
    F(WM_DEADCHAR)
    F(WM_SYSKEYDOWN)
    F(WM_SYSKEYUP)
    F(WM_SYSCHAR)
    F(WM_SYSDEADCHAR)
    F(WM_UNICHAR) //F(WM_WNT_CONVERTREQUESTEX)
    //F(WM_CONVERTREQUEST)
    //F(WM_CONVERTRESULT)
    //F(WM_INTERIM)
    F(WM_IME_STARTCOMPOSITION)
    F(WM_IME_ENDCOMPOSITION)
    F(WM_IME_COMPOSITION)
    F(WM_INITDIALOG)
    F(WM_COMMAND)
    F(WM_SYSCOMMAND)
    F(WM_TIMER)
    F(WM_HSCROLL)
    F(WM_VSCROLL)
    F(WM_INITMENU)
    F(WM_INITMENUPOPUP)
    //F(WM_SYSTIMER)
    F(WM_MENUSELECT)
    F(WM_MENUCHAR)
    F(WM_ENTERIDLE)
    F(WM_MENURBUTTONUP)
    F(WM_MENUDRAG)
    F(WM_MENUGETOBJECT)
    F(WM_UNINITMENUPOPUP)
    F(WM_MENUCOMMAND)
    F(WM_CHANGEUISTATE)
    F(WM_UPDATEUISTATE)
    F(WM_QUERYUISTATE)
    F(WM_CTLCOLORMSGBOX)
    F(WM_CTLCOLOREDIT)
    F(WM_CTLCOLORLISTBOX)
    F(WM_CTLCOLORBTN)
    F(WM_CTLCOLORDLG)
    F(WM_CTLCOLORSCROLLBAR)
    F(WM_CTLCOLORSTATIC)
    F(WM_MOUSEMOVE)
    F(WM_LBUTTONDOWN)
    F(WM_LBUTTONUP)
    F(WM_LBUTTONDBLCLK)
    F(WM_RBUTTONDOWN)
    F(WM_RBUTTONUP)
    F(WM_RBUTTONDBLCLK)
    F(WM_MBUTTONDOWN)
    F(WM_MBUTTONUP)
    F(WM_MBUTTONDBLCLK)
    F(WM_MOUSEWHEEL)
    F(WM_XBUTTONDOWN)
    F(WM_XBUTTONUP)
    F(WM_XBUTTONDBLCLK)
    F(WM_MOUSEHWHEEL)
    F(WM_PARENTNOTIFY)
    F(WM_ENTERMENULOOP)
    F(WM_EXITMENULOOP)
    F(WM_NEXTMENU)
    F(WM_SIZING)
    F(WM_CAPTURECHANGED)
    F(WM_MOVING)
    F(WM_POWERBROADCAST)
    F(WM_DEVICECHANGE)
    F(WM_MDICREATE)
    F(WM_MDIDESTROY)
    F(WM_MDIACTIVATE)
    F(WM_MDIRESTORE)
    F(WM_MDINEXT)
    F(WM_MDIMAXIMIZE)
    F(WM_MDITILE)
    F(WM_MDICASCADE)
    F(WM_MDIICONARRANGE)
    F(WM_MDIGETACTIVE)
    F(WM_MDISETMENU)
    F(WM_ENTERSIZEMOVE)
    F(WM_EXITSIZEMOVE)
    F(WM_DROPFILES)
    F(WM_MDIREFRESHMENU)
    //F(WM_IME_REPORT)
    F(WM_IME_SETCONTEXT)
    F(WM_IME_NOTIFY)
    F(WM_IME_CONTROL)
    F(WM_IME_COMPOSITIONFULL)
    F(WM_IME_SELECT)
    F(WM_IME_CHAR)
    F(WM_IME_REQUEST)
    F(WM_IME_KEYDOWN) //F(WM_IMEKEYDOWN)
    F(WM_IME_KEYUP) //F(WM_IMEKEYUP)
    F(WM_NCMOUSEHOVER)
    F(WM_MOUSEHOVER)
    F(WM_NCMOUSELEAVE)
    F(WM_MOUSELEAVE)
    F(WM_CUT)
    F(WM_COPY)
    F(WM_PASTE)
    F(WM_CLEAR)
    F(WM_UNDO)
    F(WM_RENDERFORMAT)
    F(WM_RENDERALLFORMATS)
    F(WM_DESTROYCLIPBOARD)
    F(WM_DRAWCLIPBOARD)
    F(WM_PAINTCLIPBOARD)
    F(WM_VSCROLLCLIPBOARD)
    F(WM_SIZECLIPBOARD)
    F(WM_ASKCBFORMATNAME)
    F(WM_CHANGECBCHAIN)
    F(WM_HSCROLLCLIPBOARD)
    F(WM_QUERYNEWPALETTE)
    F(WM_PALETTEISCHANGING)
    F(WM_PALETTECHANGED)
    F(WM_HOTKEY)
    F(WM_PRINT)
    F(WM_PRINTCLIENT)
    F(WM_APPCOMMAND)
    F(WM_HANDHELDFIRST)
    F(WM_HANDHELDLAST)
    F(WM_AFXFIRST)
    F(WM_AFXLAST)
    F(WM_PENWINFIRST)
    //F(WM_RCRESULT)
    //F(WM_HOOKRCRESULT)
    //F(WM_GLOBALRCCHANGE) F(WM_PENMISCINFO)
    //F(WM_SKB)
    //F(WM_HEDITCTL) F(WM_PENCTL)
    //F(WM_PENMISC)
    //F(WM_CTLINIT)
    //F(WM_PENEVENT)
    F(WM_PENWINLAST)
    F(DM_GETDEFID) F(NIN_SELECT) F(TBM_GETPOS) F(WM_PSD_PAGESETUPDLG) F(WM_USER) // F(DDM_SETFMT)
    F(CBEM_INSERTITEMA) F(DM_SETDEFID) F(HKM_SETHOTKEY) F(PBM_SETRANGE) F(RB_INSERTBANDA) F(SB_SETTEXTA) F(TB_ENABLEBUTTON) F(TBM_GETRANGEMIN) F(TTM_ACTIVATE) F(WM_CHOOSEFONT_GETLOGFONT) F(WM_PSD_FULLPAGERECT) // F(DDM_DRAW)
    F(CBEM_SETIMAGELIST) F(DM_REPOSITION) F(HKM_GETHOTKEY) F(PBM_SETPOS) F(RB_DELETEBAND) F(SB_GETTEXTA) F(TB_CHECKBUTTON) F(TBM_GETRANGEMAX) F(WM_PSD_MINMARGINRECT) // F(DDM_CLOSE)
    F(CBEM_GETIMAGELIST) F(HKM_SETRULES) F(PBM_DELTAPOS) F(RB_GETBARINFO) F(SB_GETTEXTLENGTHA) F(TBM_GETTIC) F(TB_PRESSBUTTON) F(TTM_SETDELAYTIME) F(WM_PSD_MARGINRECT) // F(DDM_BEGIN)
    F(CBEM_GETITEMA) F(PBM_SETSTEP) F(RB_SETBARINFO) F(SB_SETPARTS) F(TB_HIDEBUTTON) F(TBM_SETTIC) F(TTM_ADDTOOLA) F(WM_PSD_GREEKTEXTRECT) // F(DDM_END)
    F(CBEM_SETITEMA) F(PBM_STEPIT) F(TB_INDETERMINATE) F(TBM_SETPOS) F(TTM_DELTOOLA) F(WM_PSD_ENVSTAMPRECT)
    F(CBEM_GETCOMBOCONTROL) F(PBM_SETRANGE32) F(RB_SETBANDINFOA) F(SB_GETPARTS) F(TB_MARKBUTTON) F(TBM_SETRANGE) F(TTM_NEWTOOLRECTA) F(WM_PSD_YAFULLPAGERECT)
    F(CBEM_GETEDITCONTROL) F(PBM_GETRANGE) F(RB_SETPARENT) F(SB_GETBORDERS) F(TBM_SETRANGEMIN) F(TTM_RELAYEVENT)
    F(CBEM_SETEXSTYLE) F(PBM_GETPOS) F(RB_HITTEST) F(SB_SETMINHEIGHT) F(TBM_SETRANGEMAX) F(TTM_GETTOOLINFOA)
    F(CBEM_GETEXSTYLE) F(CBEM_GETEXTENDEDSTYLE) F(PBM_SETBARCOLOR) F(RB_GETRECT) F(SB_SIMPLE) F(TB_ISBUTTONENABLED) F(TBM_CLEARTICS) F(TTM_SETTOOLINFOA)
    F(CBEM_HASEDITCHANGED) F(RB_INSERTBANDW) F(SB_GETRECT) F(TB_ISBUTTONCHECKED) F(TBM_SETSEL) F(TTM_HITTESTA) // F(WIZ_QUERYNUMPAGES)
    F(CBEM_INSERTITEMW) F(RB_SETBANDINFOW) F(SB_SETTEXTW) F(TB_ISBUTTONPRESSED) F(TBM_SETSELSTART) F(TTM_GETTEXTA) // F(WIZ_NEXT)
    F(CBEM_SETITEMW) F(RB_GETBANDCOUNT) F(SB_GETTEXTLENGTHW) F(TB_ISBUTTONHIDDEN) F(TBM_SETSELEND) F(TTM_UPDATETIPTEXTA) // F(WIZ_PREV)
    F(CBEM_GETITEMW) F(RB_GETROWCOUNT) F(SB_GETTEXTW) F(TB_ISBUTTONINDETERMINATE) F(TTM_GETTOOLCOUNT)
    F(CBEM_SETEXTENDEDSTYLE) F(RB_GETROWHEIGHT) F(SB_ISSIMPLE) F(TB_ISBUTTONHIGHLIGHTED) F(TBM_GETPTICS) F(TTM_ENUMTOOLSA)
    F(SB_SETICON) F(TBM_GETTICPOS) F(TTM_GETCURRENTTOOLA)
    F(RB_IDTOINDEX) F(SB_SETTIPTEXTA) F(TBM_GETNUMTICS) F(TTM_WINDOWFROMPOINT)
    F(RB_GETTOOLTIPS) F(SB_SETTIPTEXTW) F(TBM_GETSELSTART) F(TB_SETSTATE) F(TTM_TRACKACTIVATE)
    F(RB_SETTOOLTIPS) F(SB_GETTIPTEXTA) F(TB_GETSTATE) F(TBM_GETSELEND) F(TTM_TRACKPOSITION)
    F(RB_SETBKCOLOR) F(SB_GETTIPTEXTW) F(TB_ADDBITMAP) F(TBM_CLEARSEL) F(TTM_SETTIPBKCOLOR)
    F(RB_GETBKCOLOR) F(SB_GETICON) F(TB_ADDBUTTONSA) F(TBM_SETTICFREQ) F(TTM_SETTIPTEXTCOLOR)
    F(RB_SETTEXTCOLOR) F(TB_INSERTBUTTONA) F(TBM_SETPAGESIZE) F(TTM_GETDELAYTIME)
    F(RB_GETTEXTCOLOR) F(TB_DELETEBUTTON) F(TBM_GETPAGESIZE) F(TTM_GETTIPBKCOLOR)
    F(RB_SIZETORECT) F(TB_GETBUTTON) F(TBM_SETLINESIZE) F(TTM_GETTIPTEXTCOLOR)
    F(RB_BEGINDRAG) F(TB_BUTTONCOUNT) F(TBM_GETLINESIZE) F(TTM_SETMAXTIPWIDTH)
    F(RB_ENDDRAG) F(TB_COMMANDTOINDEX) F(TBM_GETTHUMBRECT) F(TTM_GETMAXTIPWIDTH)
    F(RB_DRAGMOVE) F(TBM_GETCHANNELRECT) F(TB_SAVERESTOREA) F(TTM_SETMARGIN)
    F(RB_GETBARHEIGHT) F(TB_CUSTOMIZE) F(TBM_SETTHUMBLENGTH) F(TTM_GETMARGIN)
    F(RB_GETBANDINFOW) F(TB_ADDSTRINGA) F(TBM_GETTHUMBLENGTH) F(TTM_POP)
    F(RB_GETBANDINFOA) F(TB_GETITEMRECT) F(TBM_SETTOOLTIPS) F(TTM_UPDATE)
    F(RB_MINIMIZEBAND) F(TB_BUTTONSTRUCTSIZE) F(TBM_GETTOOLTIPS) F(TTM_GETBUBBLESIZE)
    F(RB_MAXIMIZEBAND) F(TBM_SETTIPSIDE) F(TB_SETBUTTONSIZE) F(TTM_ADJUSTRECT)
    F(TBM_SETBUDDY) F(TB_SETBITMAPSIZE) F(TTM_SETTITLEA)
    F(TB_AUTOSIZE) F(TBM_GETBUDDY) F(TTM_SETTITLEW) // F(MSG_FTS_JUMP_VA)
    F(RB_GETBANDBORDERS)
    F(RB_SHOWBAND) F(TB_GETTOOLTIPS) // F(MSG_FTS_JUMP_QWORD)
    F(TB_SETTOOLTIPS) // F(MSG_REINDEX_REQUEST)
    F(RB_SETPALETTE) F(TB_SETPARENT) // F(MSG_FTS_WHERE_IS_IT)
    F(RB_GETPALETTE)
    F(RB_MOVEBAND) F(TB_SETROWS)
    F(TB_GETROWS)
    F(TB_GETBITMAPFLAGS)
    F(TB_SETCMDID)
    F(RB_PUSHCHEVRON) F(TB_CHANGEBITMAP)
    F(TB_GETBITMAP)
    F(TB_GETBUTTONTEXTA) // F(MSG_GET_DEFFONT)
    F(TB_REPLACEBITMAP)
    F(TB_SETINDENT)
    F(TB_SETIMAGELIST)
    F(TB_GETIMAGELIST)
    F(TB_LOADIMAGES) F(EM_CANPASTE) F(TTM_ADDTOOLW)
    F(EM_DISPLAYBAND) F(TB_GETRECT) F(TTM_DELTOOLW)
    F(EM_EXGETSEL) F(TB_SETHOTIMAGELIST) F(TTM_NEWTOOLRECTW)
    F(EM_EXLIMITTEXT) F(TB_GETHOTIMAGELIST) F(TTM_GETTOOLINFOW)
    F(EM_EXLINEFROMCHAR) F(TB_SETDISABLEDIMAGELIST) F(TTM_SETTOOLINFOW)
    F(EM_EXSETSEL) F(TB_GETDISABLEDIMAGELIST) F(TTM_HITTESTW)
    F(EM_FINDTEXT) F(TB_SETSTYLE) F(TTM_GETTEXTW)
    F(EM_FORMATRANGE) F(TB_GETSTYLE) F(TTM_UPDATETIPTEXTW)
    F(EM_GETCHARFORMAT) F(TB_GETBUTTONSIZE) F(TTM_ENUMTOOLSW)
    F(EM_GETEVENTMASK) F(TB_SETBUTTONWIDTH) F(TTM_GETCURRENTTOOLW)
    F(EM_GETOLEINTERFACE) F(TB_SETMAXTEXTROWS)
    F(EM_GETPARAFORMAT) F(TB_GETTEXTROWS)
    F(EM_GETSELTEXT) F(TB_GETOBJECT)
    F(EM_HIDESELECTION) F(TB_GETBUTTONINFOW)
    F(EM_PASTESPECIAL) F(TB_SETBUTTONINFOW)
    F(EM_REQUESTRESIZE) F(TB_GETBUTTONINFOA)
    F(EM_SELECTIONTYPE) F(TB_SETBUTTONINFOA)
    F(EM_SETBKGNDCOLOR) F(TB_INSERTBUTTONW)
    F(EM_SETCHARFORMAT) F(TB_ADDBUTTONSW)
    F(EM_SETEVENTMASK) F(TB_HITTEST)
    F(EM_SETOLECALLBACK) F(TB_SETDRAWTEXTFLAGS)
    F(EM_SETPARAFORMAT) F(TB_GETHOTITEM)
    F(EM_SETTARGETDEVICE) F(TB_SETHOTITEM)
    F(EM_STREAMIN) F(TB_SETANCHORHIGHLIGHT)
    F(EM_STREAMOUT) F(TB_GETANCHORHIGHLIGHT)
    F(EM_GETTEXTRANGE) F(TB_GETBUTTONTEXTW)
    F(EM_FINDWORDBREAK) F(TB_SAVERESTOREW)
    F(EM_SETOPTIONS) F(TB_ADDSTRINGW)
    F(EM_GETOPTIONS) F(TB_MAPACCELERATORA)
    F(EM_FINDTEXTEX) F(TB_GETINSERTMARK)
    F(EM_GETWORDBREAKPROCEX) F(TB_SETINSERTMARK)
    F(EM_SETWORDBREAKPROCEX) F(TB_INSERTMARKHITTEST)
    F(EM_SETUNDOLIMIT) F(TB_MOVEBUTTON)
    F(TB_GETMAXSIZE)
    F(EM_REDO) F(TB_SETEXTENDEDSTYLE)
    F(EM_CANREDO) F(TB_GETEXTENDEDSTYLE)
    F(EM_GETUNDONAME) F(TB_GETPADDING)
    F(EM_GETREDONAME) F(TB_SETPADDING)
    F(EM_STOPGROUPTYPING) F(TB_SETINSERTMARKCOLOR)
    F(EM_SETTEXTMODE) F(TB_GETINSERTMARKCOLOR)
    F(EM_GETTEXTMODE) F(TB_MAPACCELERATORW)
    F(EM_AUTOURLDETECT) F(TB_GETSTRINGW)
    F(EM_GETAUTOURLDETECT) F(TB_GETSTRINGA)
    F(EM_SETPALETTE)
    F(EM_GETTEXTEX)
    F(EM_GETTEXTLENGTHEX)
    F(EM_SHOWSCROLLBAR)
    F(EM_SETTEXTEX)
    //F(TAPI_REPLY)
    F(ACM_OPENA) F(CDM_GETSPEC) F(EM_SETPUNCTUATION) F(IPM_CLEARADDRESS) // F(WM_CAP_UNICODE_START) F(BFFM_SETSTATUSTEXTA)
    F(ACM_PLAY) F(CDM_GETFILEPATH) F(EM_GETPUNCTUATION) F(IPM_SETADDRESS) F(PSM_SETCURSEL) F(UDM_SETRANGE) F(WM_CHOOSEFONT_SETLOGFONT) // F(BFFM_ENABLEOK)
    F(ACM_STOP) F(CDM_GETFOLDERPATH) F(EM_SETWORDWRAPMODE) F(IPM_GETADDRESS) F(PSM_REMOVEPAGE) F(UDM_GETRANGE) F(WM_CHOOSEFONT_SETFLAGS) // F(BFFM_SETSELECTIONA) F(WM_CAP_SET_CALLBACK_ERRORW)
    F(ACM_OPENW) F(CDM_GETFOLDERIDLIST) F(EM_GETWORDWRAPMODE) F(IPM_SETRANGE) F(PSM_ADDPAGE) F(UDM_SETPOS) // F(BFFM_SETSELECTIONW) F(WM_CAP_SET_CALLBACK_STATUSW)
    F(CDM_SETCONTROLTEXT) F(EM_SETIMECOLOR) F(IPM_SETFOCUS) F(PSM_CHANGED) F(UDM_GETPOS) // F(BFFM_SETSTATUSTEXTW)
    F(CDM_HIDECONTROL) F(EM_GETIMECOLOR) F(IPM_ISBLANK) F(PSM_RESTARTWINDOWS) F(UDM_SETBUDDY)
    F(CDM_SETDEFEXT) F(EM_SETIMEOPTIONS) F(PSM_REBOOTSYSTEM) F(UDM_GETBUDDY)
    F(EM_GETIMEOPTIONS) F(PSM_CANCELTOCLOSE) F(UDM_SETACCEL)
    F(EM_CONVPOSITION) F(EM_CONVPOSITION) F(PSM_QUERYSIBLINGS) F(UDM_GETACCEL)
    F(PSM_UNCHANGED) F(UDM_SETBASE) // F(MCIWNDM_GETZOOM) 
    F(PSM_APPLY) F(UDM_GETBASE)
    F(PSM_SETTITLEA) F(UDM_SETRANGE32)
    F(PSM_SETWIZBUTTONS) F(UDM_GETRANGE32) // F(WM_CAP_DRIVER_GET_NAMEW)
    F(PSM_PRESSBUTTON) F(UDM_SETPOS32) // F(WM_CAP_DRIVER_GET_VERSIONW)
    F(PSM_SETCURSELID) F(UDM_GETPOS32)
    F(PSM_SETFINISHTEXTA)
    F(PSM_GETTABCONTROL)
    F(PSM_ISDIALOGMESSAGE)
    F(PSM_GETCURRENTPAGEHWND) // F(MCIWNDM_REALIZE)
    F(PSM_INSERTPAGE) // F(MCIWNDM_SETTIMEFORMATA)
    F(EM_SETLANGOPTIONS) F(PSM_SETTITLEW) // F(MCIWNDM_GETTIMEFORMATA) F(WM_CAP_FILE_SET_CAPTURE_FILEW)
    F(EM_GETLANGOPTIONS) F(PSM_SETFINISHTEXTW) // F(MCIWNDM_VALIDATEMEDIA) F(WM_CAP_FILE_GET_CAPTURE_FILEW)
    F(EM_GETIMECOMPMODE)
    F(EM_FINDTEXTW) // F(MCIWNDM_PLAYTO) F(WM_CAP_FILE_SAVEASW)
    F(EM_FINDTEXTEXW) // F(MCIWNDM_GETFILENAMEA)
    F(EM_RECONVERSION) F(PSM_SETHEADERTITLEA) // F(MCIWNDM_GETDEVICEA) F(WM_CAP_FILE_SAVEDIBW)
    F(EM_SETIMEMODEBIAS) F(PSM_SETHEADERTITLEW) // F(MCIWNDM_GETPALETTE)
    F(EM_GETIMEMODEBIAS) F(PSM_SETHEADERSUBTITLEA) // F(MCIWNDM_SETPALETTE)
    F(PSM_SETHEADERSUBTITLEW) // F(MCIWNDM_GETERRORA)
    F(PSM_HWNDTOINDEX)
    F(PSM_INDEXTOHWND)
    F(PSM_PAGETOINDEX) // F(MCIWNDM_SETINACTIVETIMER)
    F(PSM_INDEXTOPAGE)
    F(DL_BEGINDRAG) F(PSM_IDTOINDEX) // F(MCIWNDM_GETINACTIVETIMER)
    F(DL_DRAGGING) F(PSM_INDEXTOID)
    F(DL_DROPPED) F(PSM_GETRESULT)
    F(DL_CANCELDRAG) F(PSM_RECALCPAGESIZES)
    // F(MCIWNDM_GET_SOURCE)
    // F(MCIWNDM_PUT_SOURCE)
    // F(MCIWNDM_GET_DEST)
    // F(MCIWNDM_PUT_DEST)
    // F(MCIWNDM_CAN_PLAY)
    // F(MCIWNDM_CAN_WINDOW)
    // F(MCIWNDM_CAN_RECORD)
    // F(MCIWNDM_CAN_SAVE)
    // F(MCIWNDM_CAN_EJECT)
    // F(MCIWNDM_CAN_CONFIG)
    // F(IE_GETINK) F(MCIWNDM_PALETTEKICK)
    // F(IE_SETINK)
    // F(IE_GETPENTIP)
    // F(IE_SETPENTIP)
    // F(IE_GETERASERTIP)
    // F(IE_SETERASERTIP)
    // F(IE_GETBKGND)
    // F(IE_SETBKGND)
    // F(IE_GETGRIDORIGIN)
    // F(IE_SETGRIDORIGIN)
    // F(IE_GETGRIDPEN)
    // F(IE_SETGRIDPEN)
    // F(IE_GETGRIDSIZE)
    // F(IE_SETGRIDSIZE)
    // F(IE_GETMODE)
    // F(IE_SETMODE)
    // F(IE_GETINKRECT) F(WM_CAP_SET_MCI_DEVICEW)
    // F(WM_CAP_GET_MCI_DEVICEW)
    // F(WM_CAP_PAL_OPENW)
    // F(WM_CAP_PAL_SAVEW)
    // F(IE_GETAPPDATA)
    // F(IE_SETAPPDATA)
    // F(IE_GETDRAWOPTS)
    // F(IE_SETDRAWOPTS)
    // F(IE_GETFORMAT)
    // F(IE_SETFORMAT)
    // F(IE_GETINKINPUT)
    // F(IE_SETINKINPUT)
    // F(IE_GETNOTIFY)
    // F(IE_SETNOTIFY)
    // F(IE_GETRECOG)
    // F(IE_SETRECOG)
    // F(IE_GETSECURITY)
    // F(IE_SETSECURITY)
    // F(IE_GETSEL)
    // F(IE_SETSEL)
    F(EM_SETBIDIOPTIONS) // F(IE_DOCOMMAND) F(MCIWNDM_NOTIFYMODE)
    F(EM_GETBIDIOPTIONS) // F(IE_GETCOMMAND)
    F(EM_SETTYPOGRAPHYOPTIONS) // F(IE_GETCOUNT)
    F(EM_GETTYPOGRAPHYOPTIONS) // F(IE_GETGESTURE) F(MCIWNDM_NOTIFYMEDIA)
    F(EM_SETEDITSTYLE) // F(IE_GETMENU)
    F(EM_GETEDITSTYLE) // F(IE_GETPAINTDC) F(MCIWNDM_NOTIFYERROR)
    // F(IE_GETPDEVENT)
    // F(IE_GETSELCOUNT)
    // F(IE_GETSELITEMS)
    // F(IE_GETSTYLE)
    // F(MCIWNDM_SETTIMEFORMATW)
    F(EM_OUTLINE) // F(MCIWNDM_GETTIMEFORMATW)
    F(EM_GETSCROLLPOS)
    F(EM_SETSCROLLPOS) F(EM_SETSCROLLPOS)
    F(EM_SETFONTSIZE)
    F(EM_GETZOOM) // F(MCIWNDM_GETFILENAMEW)
    F(EM_SETZOOM) // F(MCIWNDM_GETDEVICEW)
    F(EM_GETVIEWKIND)
    F(EM_SETVIEWKIND)
    F(EM_GETPAGE) // F(MCIWNDM_GETERRORW)
    F(EM_SETPAGE)
    F(EM_GETHYPHENATEINFO)
    F(EM_SETHYPHENATEINFO)
    F(EM_GETPAGEROTATE)
    F(EM_SETPAGEROTATE)
    F(EM_GETCTFMODEBIAS)
    F(EM_SETCTFMODEBIAS)
    F(EM_GETCTFOPENSTATUS)
    F(EM_SETCTFOPENSTATUS)
    F(EM_GETIMECOMPTEXT)
    F(EM_ISIME)
    F(EM_GETIMEPROPERTY)
    F(EM_GETQUERYRTFOBJ)
    F(EM_SETQUERYRTFOBJ)
    // F(FM_GETFOCUS)
    // F(FM_GETDRIVEINFOA)
    // F(FM_GETSELCOUNT)
    // F(FM_GETSELCOUNTLFN)
    // F(FM_GETFILESELA)
    // F(FM_GETFILESELLFNA)
    // F(FM_REFRESH_WINDOWS)
    // F(FM_RELOAD_EXTENSIONS)
    // F(FM_GETDRIVEINFOW)
    // F(FM_GETFILESELW)
    // F(FM_GETFILESELLFNW)
    // F(WLX_WM_SAS)
    // F(SM_GETSELCOUNT) F(UM_GETSELCOUNT) F(WM_CPL_LAUNCH)
    // F(SM_GETSERVERSELA) F(UM_GETUSERSELA) F(WM_CPL_LAUNCHED)
    // F(SM_GETSERVERSELW) F(UM_GETUSERSELW)
    // F(SM_GETCURFOCUSA) F(UM_GETGROUPSELA)
    // F(SM_GETCURFOCUSW) F(UM_GETGROUPSELW)
    // F(SM_GETOPTIONS) F(UM_GETCURFOCUSA)
    // F(UM_GETCURFOCUSW)
    // F(UM_GETOPTIONS)
    // F(UM_GETOPTIONS2)
    F(LVM_GETBKCOLOR)
    F(LVM_SETBKCOLOR)
    F(LVM_GETIMAGELIST)
    F(LVM_SETIMAGELIST)
    F(LVM_GETITEMCOUNT)
    F(LVM_GETITEMA)
    F(LVM_SETITEMA)
    F(LVM_INSERTITEMA)
    F(LVM_DELETEITEM)
    F(LVM_DELETEALLITEMS)
    F(LVM_GETCALLBACKMASK)
    F(LVM_SETCALLBACKMASK)
    F(LVM_GETNEXTITEM)
    F(LVM_FINDITEMA)
    F(LVM_GETITEMRECT)
    F(LVM_SETITEMPOSITION)
    F(LVM_GETITEMPOSITION)
    F(LVM_GETSTRINGWIDTHA)
    F(LVM_HITTEST)
    F(LVM_ENSUREVISIBLE)
    F(LVM_SCROLL)
    F(LVM_REDRAWITEMS)
    F(LVM_ARRANGE)
    F(LVM_EDITLABELA)
    F(LVM_GETEDITCONTROL)
    F(LVM_GETCOLUMNA)
    F(LVM_SETCOLUMNA)
    F(LVM_INSERTCOLUMNA)
    F(LVM_DELETECOLUMN)
    F(LVM_GETCOLUMNWIDTH)
    F(LVM_SETCOLUMNWIDTH)
    F(LVM_GETHEADER)
    F(LVM_CREATEDRAGIMAGE)
    F(LVM_GETVIEWRECT)
    F(LVM_GETTEXTCOLOR)
    F(LVM_SETTEXTCOLOR)
    F(LVM_GETTEXTBKCOLOR)
    F(LVM_SETTEXTBKCOLOR)
    F(LVM_GETTOPINDEX)
    F(LVM_GETCOUNTPERPAGE)
    F(LVM_GETORIGIN)
    F(LVM_UPDATE)
    F(LVM_SETITEMSTATE)
    F(LVM_GETITEMSTATE)
    F(LVM_GETITEMTEXTA)
    F(LVM_SETITEMTEXTA)
    F(LVM_SETITEMCOUNT)
    F(LVM_SORTITEMS)
    F(LVM_SETITEMPOSITION32)
    F(LVM_GETSELECTEDCOUNT)
    F(LVM_GETITEMSPACING)
    F(LVM_GETISEARCHSTRINGA)
    F(LVM_SETICONSPACING)
    F(LVM_SETEXTENDEDLISTVIEWSTYLE)
    F(LVM_GETEXTENDEDLISTVIEWSTYLE)
    F(LVM_GETSUBITEMRECT)
    F(LVM_SUBITEMHITTEST)
    F(LVM_SETCOLUMNORDERARRAY)
    F(LVM_GETCOLUMNORDERARRAY)
    F(LVM_SETHOTITEM)
    F(LVM_GETHOTITEM)
    F(LVM_SETHOTCURSOR)
    F(LVM_GETHOTCURSOR)
    F(LVM_APPROXIMATEVIEWRECT)
    F(LVM_SETWORKAREAS)
    F(LVM_GETSELECTIONMARK)
    F(LVM_SETSELECTIONMARK)
    F(LVM_SETBKIMAGEA)
    F(LVM_GETBKIMAGEA)
    F(LVM_GETWORKAREAS)
    F(LVM_SETHOVERTIME)
    F(LVM_GETHOVERTIME)
    F(LVM_GETNUMBEROFWORKAREAS)
    F(LVM_SETTOOLTIPS)
    F(LVM_GETITEMW)
    F(LVM_SETITEMW)
    F(LVM_INSERTITEMW)
    F(LVM_GETTOOLTIPS)
    F(LVM_FINDITEMW)
    F(LVM_GETSTRINGWIDTHW)
    F(LVM_GETCOLUMNW)
    F(LVM_SETCOLUMNW)
    F(LVM_INSERTCOLUMNW)
    F(LVM_GETITEMTEXTW)
    F(LVM_SETITEMTEXTW)
    F(LVM_GETISEARCHSTRINGW)
    F(LVM_EDITLABELW)
    F(LVM_GETBKIMAGEW)
    F(LVM_SETSELECTEDCOLUMN)
    // F(LVM_SETTILEWIDTH)
    F(LVM_SETVIEW)
    F(LVM_GETVIEW)
    F(LVM_INSERTGROUP)
    F(LVM_SETGROUPINFO)
    F(LVM_GETGROUPINFO)
    F(LVM_REMOVEGROUP)
    F(LVM_MOVEGROUP)
    F(LVM_MOVEITEMTOGROUP)
    F(LVM_SETGROUPMETRICS)
    F(LVM_GETGROUPMETRICS)
    F(LVM_ENABLEGROUPVIEW)
    F(LVM_SORTGROUPS)
    F(LVM_INSERTGROUPSORTED)
    F(LVM_REMOVEALLGROUPS)
    F(LVM_HASGROUP)
    F(LVM_SETTILEVIEWINFO)
    F(LVM_GETTILEVIEWINFO)
    F(LVM_SETTILEINFO)
    F(LVM_GETTILEINFO)
    F(LVM_SETINSERTMARK)
    F(LVM_GETINSERTMARK)
    F(LVM_INSERTMARKHITTEST)
    F(LVM_GETINSERTMARKRECT)
    F(LVM_SETINSERTMARKCOLOR)
    F(LVM_GETINSERTMARKCOLOR)
    F(LVM_SETINFOTIP)
    F(LVM_GETSELECTEDCOLUMN)
    F(LVM_ISGROUPVIEWENABLED)
    F(LVM_GETOUTLINECOLOR)
    F(LVM_SETOUTLINECOLOR)
    F(LVM_CANCELEDITLABEL)
    F(LVM_MAPINDEXTOID)
    F(LVM_MAPIDTOINDEX)
    F(LVM_ISITEMVISIBLE)
    // F(OCM__BASE)
    F(LVM_SETUNICODEFORMAT)
    F(LVM_GETUNICODEFORMAT)
    // F(OCM_CTLCOLOR)
    // F(OCM_DRAWITEM)
    // F(OCM_MEASUREITEM)
    // F(OCM_DELETEITEM)
    // F(OCM_VKEYTOITEM)
    // F(OCM_CHARTOITEM)
    // F(OCM_COMPAREITEM)
    // F(OCM_NOTIFY)
    // F(OCM_COMMAND)
    // F(OCM_HSCROLL)
    // F(OCM_VSCROLL)
    // F(OCM_CTLCOLORMSGBOX)
    // F(OCM_CTLCOLOREDIT)
    // F(OCM_CTLCOLORLISTBOX)
    // F(OCM_CTLCOLORBTN)
    // F(OCM_CTLCOLORDLG)
    // F(OCM_CTLCOLORSCROLLBAR)
    // F(OCM_CTLCOLORSTATIC)
    // F(OCM_PARENTNOTIFY)
    F(WM_APP)
    // F(WM_RASDIALEVENT)
#undef F
};

UINT GetMsg(const TCHAR* s)
{
    if (s == nullptr)
        return 0;

    for (const auto& m : Messages)
    {
        if (_tcsicmp(m.sName, s) == 0)
            return m.uMsg;
    }
    return ConvertToULong(s, 0);
}

const TCHAR* GetMsgName(UINT u)
{
    for (const auto& m : Messages)
    {
        if (m.uMsg == u)
            return m.sName;
    }
    return _T("Unknown");
}

int _tmain(int argc, const TCHAR* const argv[])
{
    arginit(argc, argv);
    HWND hWnd = GetWindow(argnum(1, nullptr, _T("hwnd"), nullptr));
    UINT uMsg = GetMsg(argnum(2, nullptr, _T("msg"), nullptr));
    argoptional();
    WPARAM wParam = ConvertToULong(argnum(3, nullptr, _T("wparam"), nullptr), 0);
    LPARAM lParam = ConvertToULong(argnum(4, nullptr, _T("lparam"), nullptr), 0);
	if (!argcleanup())
        return EXIT_FAILURE;
    if (argusage(hWnd == NULL))
    {
        _ftprintf(stdout, _T("   where " ARG_OPTION("hwnd") " can be in hex or one of " ARG_VALUE("{cursor}") ", " ARG_VALUE("{console}") " or " ARG_VALUE("{foreground}") "\n"));
        return EXIT_SUCCESS;
    }

    const LRESULT lResult = SendMessage(hWnd, uMsg, wParam, lParam);
    _ftprintf(stderr, _T("0x%08") _T(PRIXPTR) _T(" %s(%#x) %llu %llu -> %llu\n"), reinterpret_cast<uintptr_t>(hWnd), GetMsgName(uMsg), uMsg, wParam, lParam, lResult);
    //return EXIT_SUCCESS;
    return (int) lResult;
}
